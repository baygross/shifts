
  <div class="close_link">
  		<a onclick="$('#tooltip').fadeOut(function (){ $(this).remove() }); return false;" href="#">[esc]</a>
  </div>
  <h2>Add New Time Slot</h2>

  <% if current_user.is_admin_of?(@department) %>
    <p>
      <%= check_box_tag :repeating_event, false, false, :onclick => "$('.toggle_me').toggle()" %> Repeating event?
    </p>
  <% end %>

  <div class="toggle_me">
    <% remote_form_for @time_slot do |f| %>
      <%= f.error_messages %>
      <%= render :partial => 'time_slots/form', :locals => {:f => f}  %>
      <p><%= submit_to_remote "add_button", "Create New", :url => { :action => 'create' } %></p>
    <% end %>
  </div>

  <% if current_user.is_admin_of?(@department) %>
    <div class="toggle_me" style="display:none">
      <% remote_form_for (@repeating_event = RepeatingEvent.new) do |f| %>
        <%= render :partial => 'time_slots/form_repeating', :locals => {:f => f} %>
        <%= hidden_field_tag 'rerender_date', params[:date] %>
        <p><%= submit_to_remote "add_button", "Create New Repeating Event", :url => { :controller => 'repeating_events', :action => 'create', :calendar => params[:calendar] } %></p>
      <% end %>
    </div>
  <% end %>

<script type="text/javascript">
// don't retrigger the action when clicking the tooltip :P
$('#tooltip').click(function(e){
	e.stopPropagation();
});
$(this).keyup(function(event) {
  if (event.keyCode == 27) {
     $('#tooltip').fadeOut(function (){ $(this).remove() });
	 return false;
   }
});
$(this).click(function(event) {
	if ($('#tooltip').length == 1) {
     $('#tooltip').fadeOut(function (){ $(this).remove() });
		return(false);
	}
});

